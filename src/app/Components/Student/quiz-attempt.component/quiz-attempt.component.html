<div class="container">
  <div *ngIf="loading" class="text-center">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p>Loading quiz...</p>
  </div>

  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <div *ngIf="quiz && !loading">
    <div class="text-center mb-4">
      <h2>{{ quiz.quizText }}</h2>
      <p class="lead">
        Question {{ currentQuestionIndex + 1 }} of {{ quiz.questions.length }}
        <span class="badge bg-secondary ms-2">{{ answeredCount }} answered</span>
      </p>
    </div>

    <div class="d-flex flex-wrap justify-content-center gap-2 mb-4">
      <button
        *ngFor="let q of quiz.questions; let i = index"
        (click)="goToQuestion(i)"
        class="btn"
        [ngClass]="{
          'btn-primary': i === currentQuestionIndex,
          'btn-outline-primary': i !== currentQuestionIndex && !isQuestionAnswered(q.questionId!),
          'btn-success': i !== currentQuestionIndex && isQuestionAnswered(q.questionId!)
        }"
      >
        {{ i + 1 }}
      </button>
    </div>

    <div *ngIf="currentQuestion" class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">
          Q{{ currentQuestionIndex + 1 }}. {{ currentQuestion.questionText }}
        </h5>
      </div>
      <div class="list-group list-group-flush">
        <button
          type="button"
          *ngFor="let option of currentQuestion.options; let i = index"
          (click)="selectOption(currentQuestion.questionId!, option.optionId!)"
          class="list-group-item list-group-item-action"
          [ngClass]="{ 'active': isOptionSelected(currentQuestion.questionId!, option.optionId!) }"
        >
          <span class="fw-bold me-2">{{ 'ABCD'[i] }}</span>
          {{ option.optionText }}
        </button>
      </div>
    </div>

    <div class="d-flex justify-content-between mt-4">
      <button
        (click)="prevQuestion()"
        [disabled]="currentQuestionIndex === 0"
        class="btn btn-secondary"
      >
        &larr; Previous
      </button>

      <button
        *ngIf="currentQuestionIndex < quiz.questions.length - 1"
        (click)="nextQuestion()"
        class="btn btn-primary"
      >
        Next &rarr;
      </button>

      <button
        *ngIf="currentQuestionIndex === quiz.questions.length - 1"
        (click)="submitQuiz()"
        [disabled]="submitting || answeredCount === 0"
        class="btn btn-success"
      >
        {{ submitting ? 'Submitting...' : 'Submit Quiz' }}
      </button>
    </div>

    <div *ngIf="answeredCount < quiz.questions.length" class="alert alert-warning mt-4">
      You have answered {{ answeredCount }} out of {{ quiz.questions.length }} questions.
    </div>
  </div>
</div>