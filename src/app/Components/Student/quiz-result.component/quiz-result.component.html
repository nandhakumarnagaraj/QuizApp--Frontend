<div class="container">
  <div *ngIf="loading" class="text-center">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p>Loading result...</p>
  </div>

  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <div *ngIf="result">
    <div class="card text-center mb-4">
      <div class="card-header">
        <h2>Quiz Completed!</h2>
      </div>
      <div class="card-body">
        <h5 class="card-title">{{ result.quizText }}</h5>
        <div
          class="display-1 fw-bold p-4 rounded-circle d-inline-block"
          [ngClass]="'bg-' + getGradeClass(result.grade) + '-light'"
        >
          {{ result.grade }}
        </div>
        <p class="h4 mt-3">{{ result.percentage | number:'1.0-0' }}%</p>
        <div class="row mt-4">
          <div class="col">
            <h5>Score</h5>
            <p class="fs-4">{{ result.score }} / {{ result.totalQuestions }}</p>
          </div>
          <div class="col">
            <h5 class="text-success">Correct</h5>
            <p class="fs-4">{{ result.correctAnswers }}</p>
          </div>
          <div class="col">
            <h5 class="text-danger">Wrong</h5>
            <p class="fs-4">{{ result.wrongAnswers }}</p>
          </div>
        </div>
      </div>
    </div>

    <h3>Review Answers</h3>

    <div class="accordion" id="accordionResults">
      <div
        *ngFor="let qr of result.questionResults; let i = index"
        class="accordion-item"
      >
        <h2 class="accordion-header" [id]="'heading' + i">
          <button
            class="accordion-button collapsed"
            type="button"
            data-bs-toggle="collapse"
            [attr.data-bs-target]="'#collapse' + i"
            aria-expanded="false"
            [attr.aria-controls]="'collapse' + i"
          >
            <span
              class="badge me-3"
              [ngClass]="qr.isCorrect ? 'bg-success' : 'bg-danger'"
            >
              {{ qr.isCorrect ? '✓' : '✗' }}
            </span>
            Q{{ i + 1 }}. {{ qr.questionText }}
          </button>
        </h2>
        <div
          [id]="'collapse' + i"
          class="accordion-collapse collapse"
          [attr.aria-labelledby]="'heading' + i"
          data-bs-parent="#accordionResults"
        >
          <div class="accordion-body">
            <p [ngClass]="qr.isCorrect ? 'text-success' : 'text-danger'">
              <strong>Your Answer:</strong> {{ qr.selectedAnswer }}
            </p>
            <p *ngIf="!qr.isCorrect" class="text-success">
              <strong>Correct Answer:</strong> {{ qr.correctAnswer }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center mt-4">
      <a routerLink="/quizzes" class="btn btn-primary me-2">Back to Quizzes</a>
      <a routerLink="/my-attempts" class="btn btn-secondary">View All Attempts</a>
    </div>
  </div>
</div>